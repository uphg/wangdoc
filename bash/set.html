<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>set 命令，shopt 命令 | WangDoc</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="stylesheet" href="/wangdoc/font/index.css">
    <meta name="description" content="Carried from Ruan Yifeng">
    
    <link rel="preload" href="/wangdoc/assets/css/0.styles.b8e2a6d5.css" as="style"><link rel="preload" href="/wangdoc/assets/js/app.8723d088.js" as="script"><link rel="preload" href="/wangdoc/assets/js/2.9a1a264e.js" as="script"><link rel="preload" href="/wangdoc/assets/js/81.76626d4f.js" as="script"><link rel="preload" href="/wangdoc/assets/js/3.59361ec6.js" as="script"><link rel="prefetch" href="/wangdoc/assets/js/10.fffc7a41.js"><link rel="prefetch" href="/wangdoc/assets/js/100.3e59f891.js"><link rel="prefetch" href="/wangdoc/assets/js/101.ef65efb9.js"><link rel="prefetch" href="/wangdoc/assets/js/102.75a61923.js"><link rel="prefetch" href="/wangdoc/assets/js/103.950126da.js"><link rel="prefetch" href="/wangdoc/assets/js/104.0a3f6380.js"><link rel="prefetch" href="/wangdoc/assets/js/105.a8a2751c.js"><link rel="prefetch" href="/wangdoc/assets/js/106.0909bfd6.js"><link rel="prefetch" href="/wangdoc/assets/js/107.61dd327f.js"><link rel="prefetch" href="/wangdoc/assets/js/108.208d689b.js"><link rel="prefetch" href="/wangdoc/assets/js/109.3429b861.js"><link rel="prefetch" href="/wangdoc/assets/js/11.8e77b7fa.js"><link rel="prefetch" href="/wangdoc/assets/js/110.b17a98c3.js"><link rel="prefetch" href="/wangdoc/assets/js/111.67089df7.js"><link rel="prefetch" href="/wangdoc/assets/js/112.a61e4aac.js"><link rel="prefetch" href="/wangdoc/assets/js/113.8d129cc4.js"><link rel="prefetch" href="/wangdoc/assets/js/114.91202325.js"><link rel="prefetch" href="/wangdoc/assets/js/115.9232db7a.js"><link rel="prefetch" href="/wangdoc/assets/js/116.3f57f7fa.js"><link rel="prefetch" href="/wangdoc/assets/js/117.39fbb4a2.js"><link rel="prefetch" href="/wangdoc/assets/js/118.98fbb079.js"><link rel="prefetch" href="/wangdoc/assets/js/119.b802df94.js"><link rel="prefetch" href="/wangdoc/assets/js/12.5dfcc468.js"><link rel="prefetch" href="/wangdoc/assets/js/120.f2f3e969.js"><link rel="prefetch" href="/wangdoc/assets/js/121.ddc41600.js"><link rel="prefetch" href="/wangdoc/assets/js/122.1f9e6996.js"><link rel="prefetch" href="/wangdoc/assets/js/123.3dab5cb7.js"><link rel="prefetch" href="/wangdoc/assets/js/124.b5634c42.js"><link rel="prefetch" href="/wangdoc/assets/js/125.ba352811.js"><link rel="prefetch" href="/wangdoc/assets/js/126.98b393c9.js"><link rel="prefetch" href="/wangdoc/assets/js/127.b496b115.js"><link rel="prefetch" href="/wangdoc/assets/js/128.efd428c1.js"><link rel="prefetch" href="/wangdoc/assets/js/129.611df66b.js"><link rel="prefetch" href="/wangdoc/assets/js/13.a62f0816.js"><link rel="prefetch" href="/wangdoc/assets/js/130.4b7a2d82.js"><link rel="prefetch" href="/wangdoc/assets/js/131.bdc89fb1.js"><link rel="prefetch" href="/wangdoc/assets/js/132.81e9f548.js"><link rel="prefetch" href="/wangdoc/assets/js/133.5eb3b1b7.js"><link rel="prefetch" href="/wangdoc/assets/js/134.38475e6b.js"><link rel="prefetch" href="/wangdoc/assets/js/135.97431481.js"><link rel="prefetch" href="/wangdoc/assets/js/136.30b1e941.js"><link rel="prefetch" href="/wangdoc/assets/js/137.73813383.js"><link rel="prefetch" href="/wangdoc/assets/js/138.b01b5323.js"><link rel="prefetch" href="/wangdoc/assets/js/139.c1684e59.js"><link rel="prefetch" href="/wangdoc/assets/js/14.84f939d6.js"><link rel="prefetch" href="/wangdoc/assets/js/140.f4558659.js"><link rel="prefetch" href="/wangdoc/assets/js/141.1bc13a9c.js"><link rel="prefetch" href="/wangdoc/assets/js/142.055417da.js"><link rel="prefetch" href="/wangdoc/assets/js/143.e601ea78.js"><link rel="prefetch" href="/wangdoc/assets/js/144.1e73528e.js"><link rel="prefetch" href="/wangdoc/assets/js/145.6bf0a2fe.js"><link rel="prefetch" href="/wangdoc/assets/js/146.a1ae1ce8.js"><link rel="prefetch" href="/wangdoc/assets/js/147.b8be9cae.js"><link rel="prefetch" href="/wangdoc/assets/js/148.8cbf7229.js"><link rel="prefetch" href="/wangdoc/assets/js/149.01b6ab4a.js"><link rel="prefetch" href="/wangdoc/assets/js/15.82f0e11e.js"><link rel="prefetch" href="/wangdoc/assets/js/150.4c804003.js"><link rel="prefetch" href="/wangdoc/assets/js/151.d7e5eb85.js"><link rel="prefetch" href="/wangdoc/assets/js/152.14229211.js"><link rel="prefetch" href="/wangdoc/assets/js/153.0d37926e.js"><link rel="prefetch" href="/wangdoc/assets/js/154.8bcfe02c.js"><link rel="prefetch" href="/wangdoc/assets/js/155.527ee7a3.js"><link rel="prefetch" href="/wangdoc/assets/js/156.38bc424c.js"><link rel="prefetch" href="/wangdoc/assets/js/157.3e0373c8.js"><link rel="prefetch" href="/wangdoc/assets/js/158.fc8b752f.js"><link rel="prefetch" href="/wangdoc/assets/js/159.c93507b3.js"><link rel="prefetch" href="/wangdoc/assets/js/16.5f5758fa.js"><link rel="prefetch" href="/wangdoc/assets/js/160.c4b534f5.js"><link rel="prefetch" href="/wangdoc/assets/js/161.06c90281.js"><link rel="prefetch" href="/wangdoc/assets/js/162.bd0061bc.js"><link rel="prefetch" href="/wangdoc/assets/js/163.7dc573cc.js"><link rel="prefetch" href="/wangdoc/assets/js/164.46c37e7e.js"><link rel="prefetch" href="/wangdoc/assets/js/165.8c3320bc.js"><link rel="prefetch" href="/wangdoc/assets/js/166.52bd3222.js"><link rel="prefetch" href="/wangdoc/assets/js/167.dbb3c808.js"><link rel="prefetch" href="/wangdoc/assets/js/168.e63c4c28.js"><link rel="prefetch" href="/wangdoc/assets/js/169.2a437e05.js"><link rel="prefetch" href="/wangdoc/assets/js/17.053fde3c.js"><link rel="prefetch" href="/wangdoc/assets/js/170.b7f98abe.js"><link rel="prefetch" href="/wangdoc/assets/js/171.b3b224c7.js"><link rel="prefetch" href="/wangdoc/assets/js/172.080f2b03.js"><link rel="prefetch" href="/wangdoc/assets/js/173.87af14bd.js"><link rel="prefetch" href="/wangdoc/assets/js/174.b91695a3.js"><link rel="prefetch" href="/wangdoc/assets/js/175.9db61895.js"><link rel="prefetch" href="/wangdoc/assets/js/176.026ab96b.js"><link rel="prefetch" href="/wangdoc/assets/js/177.7990a06a.js"><link rel="prefetch" href="/wangdoc/assets/js/178.374813d2.js"><link rel="prefetch" href="/wangdoc/assets/js/179.f35e9bb6.js"><link rel="prefetch" href="/wangdoc/assets/js/18.4f711126.js"><link rel="prefetch" href="/wangdoc/assets/js/180.c16c6d3b.js"><link rel="prefetch" href="/wangdoc/assets/js/181.3a5462f6.js"><link rel="prefetch" href="/wangdoc/assets/js/182.26ff6d1c.js"><link rel="prefetch" href="/wangdoc/assets/js/183.8c47c990.js"><link rel="prefetch" href="/wangdoc/assets/js/184.71fbdaa4.js"><link rel="prefetch" href="/wangdoc/assets/js/185.e0399587.js"><link rel="prefetch" href="/wangdoc/assets/js/186.b4744693.js"><link rel="prefetch" href="/wangdoc/assets/js/187.8c1edd7c.js"><link rel="prefetch" href="/wangdoc/assets/js/188.3de1c37e.js"><link rel="prefetch" href="/wangdoc/assets/js/189.d946e11d.js"><link rel="prefetch" href="/wangdoc/assets/js/19.f34b619c.js"><link rel="prefetch" href="/wangdoc/assets/js/190.612f181f.js"><link rel="prefetch" href="/wangdoc/assets/js/191.a81ba58e.js"><link rel="prefetch" href="/wangdoc/assets/js/192.42db791a.js"><link rel="prefetch" href="/wangdoc/assets/js/193.4ec3f969.js"><link rel="prefetch" href="/wangdoc/assets/js/194.fd924de9.js"><link rel="prefetch" href="/wangdoc/assets/js/195.ee0924e6.js"><link rel="prefetch" href="/wangdoc/assets/js/196.5dbb1d15.js"><link rel="prefetch" href="/wangdoc/assets/js/197.701e76ac.js"><link rel="prefetch" href="/wangdoc/assets/js/198.99352439.js"><link rel="prefetch" href="/wangdoc/assets/js/199.18de1981.js"><link rel="prefetch" href="/wangdoc/assets/js/20.63fcdeab.js"><link rel="prefetch" href="/wangdoc/assets/js/200.473e83b9.js"><link rel="prefetch" href="/wangdoc/assets/js/201.0876610e.js"><link rel="prefetch" href="/wangdoc/assets/js/202.850bec6f.js"><link rel="prefetch" href="/wangdoc/assets/js/203.5c6a0391.js"><link rel="prefetch" href="/wangdoc/assets/js/204.f6e98d0c.js"><link rel="prefetch" href="/wangdoc/assets/js/205.85a84dce.js"><link rel="prefetch" href="/wangdoc/assets/js/206.73f9ea55.js"><link rel="prefetch" href="/wangdoc/assets/js/207.877457e9.js"><link rel="prefetch" href="/wangdoc/assets/js/208.4ab305de.js"><link rel="prefetch" href="/wangdoc/assets/js/209.f631d42b.js"><link rel="prefetch" href="/wangdoc/assets/js/21.53646bd4.js"><link rel="prefetch" href="/wangdoc/assets/js/210.54866ad8.js"><link rel="prefetch" href="/wangdoc/assets/js/211.8a2461ad.js"><link rel="prefetch" href="/wangdoc/assets/js/212.1a1631ff.js"><link rel="prefetch" href="/wangdoc/assets/js/213.65a08201.js"><link rel="prefetch" href="/wangdoc/assets/js/214.e091799f.js"><link rel="prefetch" href="/wangdoc/assets/js/215.3f088f25.js"><link rel="prefetch" href="/wangdoc/assets/js/216.525ce2e2.js"><link rel="prefetch" href="/wangdoc/assets/js/217.66d821a3.js"><link rel="prefetch" href="/wangdoc/assets/js/218.1a79eb73.js"><link rel="prefetch" href="/wangdoc/assets/js/219.6268047b.js"><link rel="prefetch" href="/wangdoc/assets/js/22.36428159.js"><link rel="prefetch" href="/wangdoc/assets/js/220.9c6338ad.js"><link rel="prefetch" href="/wangdoc/assets/js/221.02146d93.js"><link rel="prefetch" href="/wangdoc/assets/js/222.eea3bd30.js"><link rel="prefetch" href="/wangdoc/assets/js/223.552d4a26.js"><link rel="prefetch" href="/wangdoc/assets/js/224.175eebf2.js"><link rel="prefetch" href="/wangdoc/assets/js/225.408dcf42.js"><link rel="prefetch" href="/wangdoc/assets/js/226.5ba00006.js"><link rel="prefetch" href="/wangdoc/assets/js/227.b7671369.js"><link rel="prefetch" href="/wangdoc/assets/js/228.3522be14.js"><link rel="prefetch" href="/wangdoc/assets/js/229.812add83.js"><link rel="prefetch" href="/wangdoc/assets/js/23.e250d2fd.js"><link rel="prefetch" href="/wangdoc/assets/js/230.9e4314dc.js"><link rel="prefetch" href="/wangdoc/assets/js/231.3a4fa902.js"><link rel="prefetch" href="/wangdoc/assets/js/232.6939ad2d.js"><link rel="prefetch" href="/wangdoc/assets/js/233.ea0f4da8.js"><link rel="prefetch" href="/wangdoc/assets/js/234.84583de3.js"><link rel="prefetch" href="/wangdoc/assets/js/235.122a476b.js"><link rel="prefetch" href="/wangdoc/assets/js/236.3f4dd591.js"><link rel="prefetch" href="/wangdoc/assets/js/237.9e8d960a.js"><link rel="prefetch" href="/wangdoc/assets/js/238.44e1491a.js"><link rel="prefetch" href="/wangdoc/assets/js/239.34e411dc.js"><link rel="prefetch" href="/wangdoc/assets/js/24.f736c744.js"><link rel="prefetch" href="/wangdoc/assets/js/240.02a03faa.js"><link rel="prefetch" href="/wangdoc/assets/js/241.892ea6ad.js"><link rel="prefetch" href="/wangdoc/assets/js/242.2727cbba.js"><link rel="prefetch" href="/wangdoc/assets/js/243.3a66a03c.js"><link rel="prefetch" href="/wangdoc/assets/js/244.87fe4877.js"><link rel="prefetch" href="/wangdoc/assets/js/245.7c8a2445.js"><link rel="prefetch" href="/wangdoc/assets/js/246.560997d4.js"><link rel="prefetch" href="/wangdoc/assets/js/247.59d98ae4.js"><link rel="prefetch" href="/wangdoc/assets/js/248.d1ccbc48.js"><link rel="prefetch" href="/wangdoc/assets/js/249.03d46d71.js"><link rel="prefetch" href="/wangdoc/assets/js/25.f48ff59a.js"><link rel="prefetch" href="/wangdoc/assets/js/250.6efa8244.js"><link rel="prefetch" href="/wangdoc/assets/js/251.0026c87f.js"><link rel="prefetch" href="/wangdoc/assets/js/26.40d3655b.js"><link rel="prefetch" href="/wangdoc/assets/js/27.38a65ddc.js"><link rel="prefetch" href="/wangdoc/assets/js/28.8b75da0a.js"><link rel="prefetch" href="/wangdoc/assets/js/29.f13fc723.js"><link rel="prefetch" href="/wangdoc/assets/js/30.315594cc.js"><link rel="prefetch" href="/wangdoc/assets/js/31.a3449021.js"><link rel="prefetch" href="/wangdoc/assets/js/32.948ef6d8.js"><link rel="prefetch" href="/wangdoc/assets/js/33.153aea70.js"><link rel="prefetch" href="/wangdoc/assets/js/34.f2788372.js"><link rel="prefetch" href="/wangdoc/assets/js/35.22e4ae1a.js"><link rel="prefetch" href="/wangdoc/assets/js/36.f48064c8.js"><link rel="prefetch" href="/wangdoc/assets/js/37.3773d5a0.js"><link rel="prefetch" href="/wangdoc/assets/js/38.93705a9c.js"><link rel="prefetch" href="/wangdoc/assets/js/39.2afce206.js"><link rel="prefetch" href="/wangdoc/assets/js/4.4b75fed9.js"><link rel="prefetch" href="/wangdoc/assets/js/40.51df798f.js"><link rel="prefetch" href="/wangdoc/assets/js/41.95d176c1.js"><link rel="prefetch" href="/wangdoc/assets/js/42.5272f207.js"><link rel="prefetch" href="/wangdoc/assets/js/43.34f2e9f3.js"><link rel="prefetch" href="/wangdoc/assets/js/44.1f785bbb.js"><link rel="prefetch" href="/wangdoc/assets/js/45.0102682b.js"><link rel="prefetch" href="/wangdoc/assets/js/46.f52a47d9.js"><link rel="prefetch" href="/wangdoc/assets/js/47.6a133660.js"><link rel="prefetch" href="/wangdoc/assets/js/48.04d685e6.js"><link rel="prefetch" href="/wangdoc/assets/js/49.2733ea4d.js"><link rel="prefetch" href="/wangdoc/assets/js/5.9bd83369.js"><link rel="prefetch" href="/wangdoc/assets/js/50.51c74ba3.js"><link rel="prefetch" href="/wangdoc/assets/js/51.a92da126.js"><link rel="prefetch" href="/wangdoc/assets/js/52.1cf0402d.js"><link rel="prefetch" href="/wangdoc/assets/js/53.c2c2b1fa.js"><link rel="prefetch" href="/wangdoc/assets/js/54.6feeeb84.js"><link rel="prefetch" href="/wangdoc/assets/js/55.808d2125.js"><link rel="prefetch" href="/wangdoc/assets/js/56.deaa66cb.js"><link rel="prefetch" href="/wangdoc/assets/js/57.b5db8ee3.js"><link rel="prefetch" href="/wangdoc/assets/js/58.f719c564.js"><link rel="prefetch" href="/wangdoc/assets/js/59.f679c996.js"><link rel="prefetch" href="/wangdoc/assets/js/6.e73d1c0a.js"><link rel="prefetch" href="/wangdoc/assets/js/60.01882b8f.js"><link rel="prefetch" href="/wangdoc/assets/js/61.024fa35f.js"><link rel="prefetch" href="/wangdoc/assets/js/62.cc7e8280.js"><link rel="prefetch" href="/wangdoc/assets/js/63.75459a91.js"><link rel="prefetch" href="/wangdoc/assets/js/64.2d330a94.js"><link rel="prefetch" href="/wangdoc/assets/js/65.5505951d.js"><link rel="prefetch" href="/wangdoc/assets/js/66.01178aa8.js"><link rel="prefetch" href="/wangdoc/assets/js/67.db24a774.js"><link rel="prefetch" href="/wangdoc/assets/js/68.f463daf1.js"><link rel="prefetch" href="/wangdoc/assets/js/69.9006ec12.js"><link rel="prefetch" href="/wangdoc/assets/js/7.1cf9234b.js"><link rel="prefetch" href="/wangdoc/assets/js/70.e3e09ec2.js"><link rel="prefetch" href="/wangdoc/assets/js/71.6fd94d1d.js"><link rel="prefetch" href="/wangdoc/assets/js/72.47af9285.js"><link rel="prefetch" href="/wangdoc/assets/js/73.8616a5b7.js"><link rel="prefetch" href="/wangdoc/assets/js/74.14894b42.js"><link rel="prefetch" href="/wangdoc/assets/js/75.d341ec20.js"><link rel="prefetch" href="/wangdoc/assets/js/76.4ffc32bc.js"><link rel="prefetch" href="/wangdoc/assets/js/77.aff4cbd1.js"><link rel="prefetch" href="/wangdoc/assets/js/78.ec37d73f.js"><link rel="prefetch" href="/wangdoc/assets/js/79.07fc5bb3.js"><link rel="prefetch" href="/wangdoc/assets/js/8.329baaa5.js"><link rel="prefetch" href="/wangdoc/assets/js/80.14824d90.js"><link rel="prefetch" href="/wangdoc/assets/js/82.9d73e231.js"><link rel="prefetch" href="/wangdoc/assets/js/83.c3bdcee0.js"><link rel="prefetch" href="/wangdoc/assets/js/84.ac8a7e3b.js"><link rel="prefetch" href="/wangdoc/assets/js/85.0d32b3d5.js"><link rel="prefetch" href="/wangdoc/assets/js/86.8aeb89ff.js"><link rel="prefetch" href="/wangdoc/assets/js/87.fd64aa61.js"><link rel="prefetch" href="/wangdoc/assets/js/88.9da6635a.js"><link rel="prefetch" href="/wangdoc/assets/js/89.e966656e.js"><link rel="prefetch" href="/wangdoc/assets/js/9.8f332061.js"><link rel="prefetch" href="/wangdoc/assets/js/90.70c4ec59.js"><link rel="prefetch" href="/wangdoc/assets/js/91.a334b611.js"><link rel="prefetch" href="/wangdoc/assets/js/92.9214298e.js"><link rel="prefetch" href="/wangdoc/assets/js/93.68cedc81.js"><link rel="prefetch" href="/wangdoc/assets/js/94.572f645a.js"><link rel="prefetch" href="/wangdoc/assets/js/95.fdaacb9c.js"><link rel="prefetch" href="/wangdoc/assets/js/96.4a04f1b6.js"><link rel="prefetch" href="/wangdoc/assets/js/97.5e22edd4.js"><link rel="prefetch" href="/wangdoc/assets/js/98.18154198.js"><link rel="prefetch" href="/wangdoc/assets/js/99.9c3f7eff.js">
    <link rel="stylesheet" href="/wangdoc/assets/css/0.styles.b8e2a6d5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="tulp-scrollbar"><div class="scrollbar-wrapper tulp-scrollbar__wrap tulp-scrollbar__wrap--hidden-default"><div class="tulp-scrollbar__view"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/wangdoc/" class="home-link router-link-active"><!----> <span class="site-name">WangDoc</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----> <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="icon search-icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M18.319 14.4326C20.7628 11.2941 20.542 6.75347 17.6569 3.86829C14.5327 0.744098 9.46734 0.744098 6.34315 3.86829C3.21895 6.99249 3.21895 12.0578 6.34315 15.182C9.22833 18.0672 13.769 18.2879 16.9075 15.8442C16.921 15.8595 16.9351 15.8745 16.9497 15.8891L21.1924 20.1317C21.5829 20.5223 22.2161 20.5223 22.6066 20.1317C22.9971 19.7412 22.9971 19.1081 22.6066 18.7175L18.364 14.4749C18.3493 14.4603 18.3343 14.4462 18.319 14.4326ZM16.2426 5.28251C18.5858 7.62565 18.5858 11.4246 16.2426 13.7678C13.8995 16.1109 10.1005 16.1109 7.75736 13.7678C5.41421 11.4246 5.41421 7.62565 7.75736 5.28251C10.1005 2.93936 13.8995 2.93936 16.2426 5.28251Z"></path></svg></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/wangdoc/html/" class="nav-link">
  HTML 教程
</a></div><div class="nav-item"><a href="/wangdoc/js/" class="nav-link">
  JavaScript 教程
</a></div><div class="nav-item"><a href="/wangdoc/es6/" class="nav-link">
  ES6 教程
</a></div><div class="nav-item"><a href="/wangdoc/webapi/" class="nav-link">
  Web API 教程
</a></div><div class="nav-item"><a href="/wangdoc/bash/" class="nav-link router-link-active">
  Bash 脚本教程
</a></div><div class="nav-item"><a href="/wangdoc/ssh/" class="nav-link">
  SSH 教程
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="相关链接" class="dropdown-title"><span class="title">相关链接</span> <span class="arrow down"></span></button> <button type="button" aria-label="相关链接" class="mobile-dropdown-title"><span class="title">相关链接</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/uphg/wangdoc" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://wangdoc.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  网道
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><div class="tulp-scrollbar"><div class="scrollbar-wrapper tulp-scrollbar__wrap tulp-scrollbar__wrap--hidden-default"><div class="tulp-scrollbar__view"><nav class="nav-links"><div class="nav-item"><a href="/wangdoc/html/" class="nav-link">
  HTML 教程
</a></div><div class="nav-item"><a href="/wangdoc/js/" class="nav-link">
  JavaScript 教程
</a></div><div class="nav-item"><a href="/wangdoc/es6/" class="nav-link">
  ES6 教程
</a></div><div class="nav-item"><a href="/wangdoc/webapi/" class="nav-link">
  Web API 教程
</a></div><div class="nav-item"><a href="/wangdoc/bash/" class="nav-link router-link-active">
  Bash 脚本教程
</a></div><div class="nav-item"><a href="/wangdoc/ssh/" class="nav-link">
  SSH 教程
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="相关链接" class="dropdown-title"><span class="title">相关链接</span> <span class="arrow down"></span></button> <button type="button" aria-label="相关链接" class="mobile-dropdown-title"><span class="title">相关链接</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/uphg/wangdoc" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://wangdoc.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  网道
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Bash 脚本教程</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/wangdoc/bash/" aria-current="page" class="sidebar-link">文档说明</a></li><li><a href="/wangdoc/bash/intro.html" class="sidebar-link">Bash 简介</a></li><li><a href="/wangdoc/bash/grammar.html" class="sidebar-link">Bash 的基本语法</a></li><li><a href="/wangdoc/bash/expansion.html" class="sidebar-link">Bash 的模式扩展</a></li><li><a href="/wangdoc/bash/quotation.html" class="sidebar-link">引号和转义</a></li><li><a href="/wangdoc/bash/variable.html" class="sidebar-link">Bash 变量</a></li><li><a href="/wangdoc/bash/string.html" class="sidebar-link">字符串操作</a></li><li><a href="/wangdoc/bash/arithmetic.html" class="sidebar-link">Bash 的算术运算</a></li><li><a href="/wangdoc/bash/readline.html" class="sidebar-link">Bash 行操作</a></li><li><a href="/wangdoc/bash/stack.html" class="sidebar-link">目录堆栈</a></li><li><a href="/wangdoc/bash/script.html" class="sidebar-link">Bash 脚本入门</a></li><li><a href="/wangdoc/bash/read.html" class="sidebar-link">read 命令</a></li><li><a href="/wangdoc/bash/condition.html" class="sidebar-link">条件判断</a></li><li><a href="/wangdoc/bash/loop.html" class="sidebar-link">循环</a></li><li><a href="/wangdoc/bash/function.html" class="sidebar-link">Bash 函数</a></li><li><a href="/wangdoc/bash/array.html" class="sidebar-link">数组</a></li><li><a href="/wangdoc/bash/set.html" aria-current="page" class="active sidebar-link">set 命令，shopt 命令</a></li><li><a href="/wangdoc/bash/debug.html" class="sidebar-link">脚本除错</a></li><li><a href="/wangdoc/bash/mktemp.html" class="sidebar-link">mktemp 命令，trap 命令</a></li><li><a href="/wangdoc/bash/startup.html" class="sidebar-link">Bash 启动环境</a></li><li><a href="/wangdoc/bash/prompt.html" class="sidebar-link">命令提示符</a></li></ul></section></li></ul> </div></div><div class="tulp-scrollbar__bar is-horizontal"><div class="tulp-scrollbar__thumb" style="width:0;transform:translateX(0%);ms-transform:translateX(0%);webkit-transform:translateX(0%);"></div></div><div class="tulp-scrollbar__bar is-vertical"><div class="tulp-scrollbar__thumb" style="height:0;transform:translateY(0%);ms-transform:translateY(0%);webkit-transform:translateY(0%);"></div></div></div></aside> <main class="page"> <div class="re-page-top"><h2 class="title"><span>set 命令，shopt 命令</span></h2></div> <div class="page-index"><div class="page-index-title"><span class="open-catalog"><svg aria-hidden="true" id="icon-arrow-right" viewBox="0 0 1024 1024" class="page-index-icon arrow-right"><path d="M797.21457646 444.0233542C639.18078066 323.41640029 481.14698487 202.80944727 323.13223847 82.18344394 266.85068662 39.24639688 185.76131065 79.36563623 185.76131065 150.16009062v723.67823145c0 70.7944544 81.08937597 110.91528018 137.37092782 67.95918369 158.01474638-120.60854033 316.04854219-241.21390605 474.08233799-361.83832207 44.83410644-34.21851065 44.83410644-101.69985674 0-135.93582949z"></path></svg> <span class="text">目录</span></span></div> <div class="page-index-content"><div class="page-catalog" style="display:none;"><div class="synopsis-wrap"><ul class="synopsis-ul"><li class="synopsis-li"><a href="/wangdoc/bash/set.html#简介" class="synopsis-link">简介</a></li><li class="synopsis-li"><a href="/wangdoc/bash/set.html#set-u" class="synopsis-link">set -u</a></li><li class="synopsis-li"><a href="/wangdoc/bash/set.html#set-x" class="synopsis-link">set -x</a></li><li class="synopsis-li"><a href="/wangdoc/bash/set.html#bash-的错误处理" class="synopsis-link">Bash 的错误处理</a></li><li class="synopsis-li"><a href="/wangdoc/bash/set.html#set-e" class="synopsis-link">set -e</a></li><li class="synopsis-li"><a href="/wangdoc/bash/set.html#set-o-pipefail" class="synopsis-link">set -o pipefail</a></li><li class="synopsis-li"><a href="/wangdoc/bash/set.html#set-e-2" class="synopsis-link">set -E</a></li><li class="synopsis-li"><a href="/wangdoc/bash/set.html#其他参数" class="synopsis-link">其他参数</a></li><li class="synopsis-li"><a href="/wangdoc/bash/set.html#set-命令总结" class="synopsis-link">set 命令总结</a></li><li class="synopsis-li"><a href="/wangdoc/bash/set.html#shopt-命令" class="synopsis-link">shopt 命令</a></li><li class="synopsis-li"><a href="/wangdoc/bash/set.html#参考链接" class="synopsis-link">参考链接</a></li></ul></div></div></div></div> <div class="theme-default-content content__default"><h1 id="set-命令-shopt-命令"><a href="#set-命令-shopt-命令" class="header-anchor">#</a> set 命令，shopt 命令</h1> <p><code>set</code>命令是 Bash 脚本的重要环节，却常常被忽视，导致脚本的安全性和可维护性出问题。本章介绍<code>set</code>的基本用法，帮助你写出更安全的 Bash 脚本。</p> <h2 id="简介"><a href="#简介" class="header-anchor">#</a> 简介</h2> <p>我们知道，Bash 执行脚本时，会创建一个子 Shell。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">bash</span> script.sh
</code></pre></div><p>上面代码中，<code>script.sh</code>是在一个子 Shell 里面执行。这个子 Shell 就是脚本的执行环境，Bash 默认给定了这个环境的各种参数。</p> <p><code>set</code>命令用来修改子 Shell 环境的运行参数，即定制环境。一共有十几个参数可以定制，<a href="https://www.gnu.org/software/bash/manual/html_node/The-Set-Builtin.html" target="_blank" rel="noopener noreferrer">官方手册<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>有完整清单，本章介绍其中最常用的几个。</p> <p>顺便提一下，如果命令行下不带任何参数，直接运行<code>set</code>，会显示所有的环境变量和 Shell 函数。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token builtin class-name">set</span>
</code></pre></div><h2 id="set-u"><a href="#set-u" class="header-anchor">#</a> set -u</h2> <p>执行脚本时，如果遇到不存在的变量，Bash 默认忽略它。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token shebang important">#!/usr/bin/env bash</span>

<span class="token builtin class-name">echo</span> <span class="token variable">$a</span>
<span class="token builtin class-name">echo</span> bar
</code></pre></div><p>上面代码中，<code>$a</code>是一个不存在的变量。执行结果如下。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">bash</span> script.sh

bar
</code></pre></div><p>可以看到，<code>echo $a</code>输出了一个空行，Bash 忽略了不存在的<code>$a</code>，然后继续执行<code>echo bar</code>。大多数情况下，这不是开发者想要的行为，遇到变量不存在，脚本应该报错，而不是一声不响地往下执行。</p> <p><code>set -u</code>就用来改变这种行为。脚本在头部加上它，遇到不存在的变量就会报错，并停止执行。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token shebang important">#!/usr/bin/env bash</span>
<span class="token builtin class-name">set</span> -u

<span class="token builtin class-name">echo</span> <span class="token variable">$a</span>
<span class="token builtin class-name">echo</span> bar
</code></pre></div><p>运行结果如下。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">bash</span> script.sh
bash: script.sh:行4: a: 未绑定的变量
</code></pre></div><p>可以看到，脚本报错了，并且不再执行后面的语句。</p> <p><code>-u</code>还有另一种写法<code>-o nounset</code>，两者是等价的。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">set</span> -o nounset
</code></pre></div><h2 id="set-x"><a href="#set-x" class="header-anchor">#</a> set -x</h2> <p>默认情况下，脚本执行后，只输出运行结果，没有其他内容。如果多个命令连续执行，它们的运行结果就会连续输出。有时会分不清，某一段内容是什么命令产生的。</p> <p><code>set -x</code>用来在运行结果之前，先输出执行的那一行命令。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token shebang important">#!/usr/bin/env bash</span>
<span class="token builtin class-name">set</span> -x

<span class="token builtin class-name">echo</span> bar
</code></pre></div><p>执行上面的脚本，结果如下。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">bash</span> script.sh
+ <span class="token builtin class-name">echo</span> bar
bar
</code></pre></div><p>可以看到，执行<code>echo bar</code>之前，该命令会先打印出来，行首以<code>+</code>表示。这对于调试复杂的脚本是很有用的。</p> <p><code>-x</code>还有另一种写法<code>-o xtrace</code>。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">set</span> -o xtrace
</code></pre></div><p>脚本当中如果要关闭命令输出，可以使用<code>set +x</code>。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>

<span class="token assign-left variable">number</span><span class="token operator">=</span><span class="token number">1</span>

<span class="token builtin class-name">set</span> -x
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$number</span> <span class="token operator">=</span> <span class="token string">&quot;1&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;Number equals 1&quot;</span>
<span class="token keyword">else</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;Number does not equal 1&quot;</span>
<span class="token keyword">fi</span>
<span class="token builtin class-name">set</span> +x
</code></pre></div><p>上面的例子中，只对特定的代码段打开命令输出。</p> <h2 id="bash-的错误处理"><a href="#bash-的错误处理" class="header-anchor">#</a> Bash 的错误处理</h2> <p>如果脚本里面有运行失败的命令（返回值非<code>0</code>），Bash 默认会继续执行后面的命令。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token shebang important">#!/usr/bin/env bash</span>

foo
<span class="token builtin class-name">echo</span> bar
</code></pre></div><p>上面脚本中，<code>foo</code>是一个不存在的命令，执行时会报错。但是，Bash 会忽略这个错误，继续往下执行。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">bash</span> script.sh
script.sh:行3: foo: 未找到命令
bar
</code></pre></div><p>可以看到，Bash 只是显示有错误，并没有终止执行。</p> <p>这种行为很不利于脚本安全和除错。实际开发中，如果某个命令失败，往往需要脚本停止执行，防止错误累积。这时，一般采用下面的写法。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">command</span> <span class="token operator">||</span> <span class="token builtin class-name">exit</span> <span class="token number">1</span>
</code></pre></div><p>上面的写法表示只要<code>command</code>有非零返回值，脚本就会停止执行。</p> <p>如果停止执行之前需要完成多个操作，就要采用下面三种写法。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 写法一</span>
<span class="token builtin class-name">command</span> <span class="token operator">||</span> <span class="token punctuation">{</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;command failed&quot;</span><span class="token punctuation">;</span> <span class="token builtin class-name">exit</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token comment"># 写法二</span>
<span class="token keyword">if</span> <span class="token operator">!</span> <span class="token builtin class-name">command</span><span class="token punctuation">;</span> <span class="token keyword">then</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;command failed&quot;</span><span class="token punctuation">;</span> <span class="token builtin class-name">exit</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token keyword">fi</span>

<span class="token comment"># 写法三</span>
<span class="token builtin class-name">command</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$?</span>&quot;</span> -ne <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;command failed&quot;</span><span class="token punctuation">;</span> <span class="token builtin class-name">exit</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token keyword">fi</span>
</code></pre></div><p>另外，除了停止执行，还有一种情况。如果两个命令有继承关系，只有第一个命令成功了，才能继续执行第二个命令，那么就要采用下面的写法。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>command1 <span class="token operator">&amp;&amp;</span> command2
</code></pre></div><h2 id="set-e"><a href="#set-e" class="header-anchor">#</a> set -e</h2> <p>上面这些写法多少有些麻烦，容易疏忽。<code>set -e</code>从根本上解决了这个问题，它使得脚本只要发生错误，就终止执行。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token shebang important">#!/usr/bin/env bash</span>
<span class="token builtin class-name">set</span> -e

foo
<span class="token builtin class-name">echo</span> bar
</code></pre></div><p>执行结果如下。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">bash</span> script.sh
script.sh:行4: foo: 未找到命令
</code></pre></div><p>可以看到，第4行执行失败以后，脚本就终止执行了。</p> <p><code>set -e</code>根据返回值来判断，一个命令是否运行失败。但是，某些命令的非零返回值可能不表示失败，或者开发者希望在命令失败的情况下，脚本继续执行下去。这时可以暂时关闭<code>set -e</code>，该命令执行结束后，再重新打开<code>set -e</code>。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">set</span> +e
command1
command2
<span class="token builtin class-name">set</span> -e
</code></pre></div><p>上面代码中，<code>set +e</code>表示关闭<code>-e</code>选项，<code>set -e</code>表示重新打开<code>-e</code>选项。</p> <p>还有一种方法是使用<code>command || true</code>，使得该命令即使执行失败，脚本也不会终止执行。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token builtin class-name">set</span> -e

foo <span class="token operator">||</span> <span class="token boolean">true</span>
<span class="token builtin class-name">echo</span> bar
</code></pre></div><p>上面代码中，<code>true</code>使得这一行语句总是会执行成功，后面的<code>echo bar</code>会执行。</p> <p><code>-e</code>还有另一种写法<code>-o errexit</code>。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">set</span> -o errexit
</code></pre></div><h2 id="set-o-pipefail"><a href="#set-o-pipefail" class="header-anchor">#</a> set -o pipefail</h2> <p><code>set -e</code>有一个例外情况，就是不适用于管道命令。</p> <p>所谓管道命令，就是多个子命令通过管道运算符（<code>|</code>）组合成为一个大的命令。Bash 会把最后一个子命令的返回值，作为整个命令的返回值。也就是说，只要最后一个子命令不失败，管道命令总是会执行成功，因此它后面命令依然会执行，<code>set -e</code>就失效了。</p> <p>请看下面这个例子。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token shebang important">#!/usr/bin/env bash</span>
<span class="token builtin class-name">set</span> -e

foo <span class="token operator">|</span> <span class="token builtin class-name">echo</span> a
<span class="token builtin class-name">echo</span> bar
</code></pre></div><p>执行结果如下。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">bash</span> script.sh
a
script.sh:行4: foo: 未找到命令
bar
</code></pre></div><p>上面代码中，<code>foo</code>是一个不存在的命令，但是<code>foo | echo a</code>这个管道命令会执行成功，导致后面的<code>echo bar</code>会继续执行。</p> <p><code>set -o pipefail</code>用来解决这种情况，只要一个子命令失败，整个管道命令就失败，脚本就会终止执行。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token shebang important">#!/usr/bin/env bash</span>
<span class="token builtin class-name">set</span> -eo pipefail

foo <span class="token operator">|</span> <span class="token builtin class-name">echo</span> a
<span class="token builtin class-name">echo</span> bar
</code></pre></div><p>运行后，结果如下。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">bash</span> script.sh
a
script.sh:行4: foo: 未找到命令
</code></pre></div><p>可以看到，<code>echo bar</code>没有执行。</p> <h2 id="set-e-2"><a href="#set-e-2" class="header-anchor">#</a> set -E</h2> <p>一旦设置了<code>-e</code>参数，会导致函数内的错误不会被<code>trap</code>命令捕获（参考《trap 命令》一章）。<code>-E</code>参数可以纠正这个行为，使得函数也能继承<code>trap</code>命令。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token builtin class-name">set</span> -e

<span class="token builtin class-name">trap</span> <span class="token string">&quot;echo ERR trap fired!&quot;</span> ERR

<span class="token function-name function">myfunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token comment"># 'foo' 是一个不存在的命令</span>
  foo
<span class="token punctuation">}</span>

myfunc
</code></pre></div><p>上面示例中，<code>myfunc</code>函数内部调用了一个不存在的命令<code>foo</code>，导致执行这个函数会报错。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">bash</span> test.sh
test.sh:行9: foo：未找到命令
</code></pre></div><p>但是，由于设置了<code>set -e</code>，函数内部的报错并没有被<code>trap</code>命令捕获，需要加上<code>-E</code>参数才可以。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token builtin class-name">set</span> -Eeuo pipefail

<span class="token builtin class-name">trap</span> <span class="token string">&quot;echo ERR trap fired!&quot;</span> ERR

<span class="token function-name function">myfunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token comment"># 'foo' 是一个不存在的命令</span>
  foo
<span class="token punctuation">}</span>

myfunc
</code></pre></div><p>执行上面这个脚本，就可以看到<code>trap</code>命令生效了。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">bash</span> test.sh
test.sh:行9: foo：未找到命令
ERR <span class="token builtin class-name">trap</span> fired<span class="token operator">!</span>
</code></pre></div><h2 id="其他参数"><a href="#其他参数" class="header-anchor">#</a> 其他参数</h2> <p><code>set</code>命令还有一些其他参数。</p> <ul><li><code>set -n</code>：等同于<code>set -o noexec</code>，不运行命令，只检查语法是否正确。</li> <li><code>set -f</code>：等同于<code>set -o noglob</code>，表示不对通配符进行文件名扩展。</li> <li><code>set -v</code>：等同于<code>set -o verbose</code>，表示打印 Shell 接收到的每一行输入。</li> <li><code>set -o noclobber</code>：防止使用重定向运算符<code>&gt;</code>覆盖已经存在的文件。</li></ul> <p>上面的<code>-f</code>和<code>-v</code>参数，可以分别使用<code>set +f</code>、<code>set +v</code>关闭。</p> <h2 id="set-命令总结"><a href="#set-命令总结" class="header-anchor">#</a> set 命令总结</h2> <p>上面重点介绍的<code>set</code>命令的几个参数，一般都放在一起使用。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 写法一</span>
<span class="token builtin class-name">set</span> -Eeuxo pipefail

<span class="token comment"># 写法二</span>
<span class="token builtin class-name">set</span> -Eeux
<span class="token builtin class-name">set</span> -o pipefail
</code></pre></div><p>这两种写法建议放在所有 Bash 脚本的头部。</p> <p>另一种办法是在执行 Bash 脚本的时候，从命令行传入这些参数。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">bash</span> -euxo pipefail script.sh
</code></pre></div><h2 id="shopt-命令"><a href="#shopt-命令" class="header-anchor">#</a> shopt 命令</h2> <p><code>shopt</code>命令用来调整 Shell 的参数，跟<code>set</code>命令的作用很类似。之所以会有这两个类似命令的主要原因是，<code>set</code>是从 Ksh 继承的，属于 POSIX 规范的一部分，而<code>shopt</code>是 Bash 特有的。</p> <p>直接输入<code>shopt</code>可以查看所有参数，以及它们各自打开和关闭的状态。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token builtin class-name">shopt</span>
</code></pre></div><p><code>shopt</code>命令后面跟着参数名，可以查询该参数是否打开。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token builtin class-name">shopt</span> globstar
globstar  off
</code></pre></div><p>上面例子表示<code>globstar</code>参数默认是关闭的。</p> <p><strong>（1）-s</strong></p> <p><code>-s</code>用来打开某个参数。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token builtin class-name">shopt</span> -s optionNameHere
</code></pre></div><p><strong>（2）-u</strong></p> <p><code>-u</code>用来关闭某个参数。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token builtin class-name">shopt</span> -u optionNameHere
</code></pre></div><p>举例来说，<code>histappend</code>这个参数表示退出当前 Shell 时，将操作历史追加到历史文件中。这个参数默认是打开的，如果使用下面的命令将其关闭，那么当前 Shell 的操作历史将替换掉整个历史文件。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token builtin class-name">shopt</span> -u histappend
</code></pre></div><p><strong>（3）-q</strong></p> <p><code>-q</code>的作用也是查询某个参数是否打开，但不是直接输出查询结果，而是通过命令的执行状态（<code>$?</code>）表示查询结果。如果状态为<code>0</code>，表示该参数打开；如果为<code>1</code>，表示该参数关闭。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token builtin class-name">shopt</span> -q globstar
$ <span class="token builtin class-name">echo</span> <span class="token variable">$?</span>
<span class="token number">1</span>
</code></pre></div><p>上面命令查询<code>globstar</code>参数是否打开。返回状态为<code>1</code>，表示该参数是关闭的。</p> <p>这个用法主要用于脚本，供<code>if</code>条件结构使用。下面例子是如果打开了这个参数，就执行<code>if</code>结构内部的语句。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token keyword">if</span> <span class="token operator">!</span><span class="token punctuation">(</span>shopt -q globstar<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token punctuation">..</span>.
<span class="token keyword">fi</span>
</code></pre></div><h2 id="参考链接"><a href="#参考链接" class="header-anchor">#</a> 参考链接</h2> <ul><li><a href="https://www.gnu.org/software/bash/manual/html_node/The-Set-Builtin.html" target="_blank" rel="noopener noreferrer">The Set Builtin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://vaneyckt.io/posts/safer_bash_scripts_with_set_euxo_pipefail/" target="_blank" rel="noopener noreferrer">Safer bash scripts with 'set -euxo pipefail'<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://www.davidpashley.com/articles/writing-robust-shell-scripts/" target="_blank" rel="noopener noreferrer">Writing Robust Bash Shell Scripts<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2021-07-20 14:30</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" class="bi bi-chevron-left"><path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"></path></svg> <a href="/wangdoc/bash/array.html" class="prev">
        数组
      </a></span> <span class="next"><a href="/wangdoc/bash/debug.html">
        脚本除错
      </a> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" class="bi bi-chevron-right"><path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"></path></svg></span></p></div> </main></div></div></div><div class="tulp-scrollbar__bar is-horizontal"><div class="tulp-scrollbar__thumb" style="width:0;transform:translateX(0%);ms-transform:translateX(0%);webkit-transform:translateX(0%);"></div></div><div class="tulp-scrollbar__bar is-vertical"><div class="tulp-scrollbar__thumb" style="height:0;transform:translateY(0%);ms-transform:translateY(0%);webkit-transform:translateY(0%);"></div></div></div><div class="global-ui"><!----></div></div>
    <script src="/wangdoc/assets/js/app.8723d088.js" defer></script><script src="/wangdoc/assets/js/2.9a1a264e.js" defer></script><script src="/wangdoc/assets/js/81.76626d4f.js" defer></script><script src="/wangdoc/assets/js/3.59361ec6.js" defer></script>
  </body>
</html>
