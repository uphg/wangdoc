(window.webpackJsonp=window.webpackJsonp||[]).push([[230],{672:function(s,e,v){"use strict";v.r(e);var _=v(76),t=Object(_.a)({},(function(){var s=this,e=s.$createElement,v=s._self._c||e;return v("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[v("h1",{attrs:{id:"ssh-服务器"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#ssh-服务器"}},[s._v("#")]),s._v(" SSH 服务器")]),s._v(" "),v("h2",{attrs:{id:"简介"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[s._v("#")]),s._v(" 简介")]),s._v(" "),v("p",[s._v("SSH 的架构是服务器/客户端模式，两端运行的软件是不一样的。OpenSSH 的客户端软件是 ssh，服务器软件是 sshd。本章介绍 sshd 的各种知识。")]),s._v(" "),v("p",[s._v("如果没有安装 sshd，可以用下面的命令安装。")]),s._v(" "),v("div",{staticClass:"language-bash extra-class"},[v("pre",{pre:!0,attrs:{class:"language-bash"}},[v("code",[v("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Debian")]),s._v("\n$ "),v("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),v("span",{pre:!0,attrs:{class:"token function"}},[s._v("aptitude")]),s._v(" "),v("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" openssh-server\n\n"),v("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Red Hat")]),s._v("\n$ "),v("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum "),v("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" openssh-server\n")])])]),v("p",[s._v("一般来说，sshd 安装后会跟着系统一起启动。如果当前 sshd 没有启动，可以用下面的命令启动。")]),s._v(" "),v("div",{staticClass:"language-bash extra-class"},[v("pre",{pre:!0,attrs:{class:"language-bash"}},[v("code",[s._v("$ sshd\n")])])]),v("p",[s._v("上面的命令运行后，如果提示“sshd re-exec requires execution with an absolute path”，就需要使用绝对路径来启动。这是为了防止有人出于各种目的，放置同名软件在"),v("code",[s._v("$PATH")]),s._v("变量指向的目录中，代替真正的 sshd。")]),s._v(" "),v("div",{staticClass:"language-bash extra-class"},[v("pre",{pre:!0,attrs:{class:"language-bash"}},[v("code",[v("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Centos、Ubuntu、OS X")]),s._v("\n$ /usr/sbin/sshd\n")])])]),v("p",[s._v("上面的命令运行以后，sshd 自动进入后台，所以命令后面不需要加上"),v("code",[s._v("&")]),s._v("。")]),s._v(" "),v("p",[s._v("除了直接运行可执行文件，也可以通过 Systemd 启动 sshd。")]),s._v(" "),v("div",{staticClass:"language-bash extra-class"},[v("pre",{pre:!0,attrs:{class:"language-bash"}},[v("code",[v("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动")]),s._v("\n$ "),v("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl start sshd.service\n\n"),v("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 停止")]),s._v("\n$ "),v("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl stop sshd.service\n\n"),v("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启")]),s._v("\n$ "),v("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart sshd.service\n")])])]),v("p",[s._v("下面的命令让 sshd 在计算机下次启动时自动运行。")]),s._v(" "),v("div",{staticClass:"language-bash extra-class"},[v("pre",{pre:!0,attrs:{class:"language-bash"}},[v("code",[s._v("$ "),v("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl "),v("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" sshd.service\n")])])]),v("h2",{attrs:{id:"sshd-配置文件"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#sshd-配置文件"}},[s._v("#")]),s._v(" sshd 配置文件")]),s._v(" "),v("p",[s._v("sshd 的配置文件在"),v("code",[s._v("/etc/ssh")]),s._v("目录，主配置文件是"),v("code",[s._v("sshd_config")]),s._v("，此外还有一些安装时生成的密钥。")]),s._v(" "),v("ul",[v("li",[v("code",[s._v("/etc/ssh/sshd_config")]),s._v("：配置文件")]),s._v(" "),v("li",[v("code",[s._v("/etc/ssh/ssh_host_ecdsa_key")]),s._v("：ECDSA 私钥。")]),s._v(" "),v("li",[v("code",[s._v("/etc/ssh/ssh_host_ecdsa_key.pub")]),s._v("：ECDSA 公钥。")]),s._v(" "),v("li",[v("code",[s._v("/etc/ssh/ssh_host_key")]),s._v("：用于 SSH 1 协议版本的 RSA 私钥。")]),s._v(" "),v("li",[v("code",[s._v("/etc/ssh/ssh_host_key.pub")]),s._v("：用于 SSH 1 协议版本的 RSA 公钥。")]),s._v(" "),v("li",[v("code",[s._v("/etc/ssh/ssh_host_rsa_key")]),s._v("：用于 SSH 2 协议版本的 RSA 私钥。")]),s._v(" "),v("li",[v("code",[s._v("/etc/ssh/ssh_host_rsa_key.pub")]),s._v("：用于 SSH 2 协议版本的 RSA 公钥。")]),s._v(" "),v("li",[v("code",[s._v("/etc/pam.d/sshd")]),s._v("：PAM 配置文件。")])]),s._v(" "),v("p",[s._v("注意，如果重装 sshd，上面这些密钥都会重新生成，导致客户端重新连接 ssh 服务器时，会跳出警告，拒绝连接。为了避免这种情况，可以在重装 sshd 时，先备份"),v("code",[s._v("/etc/ssh")]),s._v("目录，重装后再恢复这个目录。")]),s._v(" "),v("p",[s._v("配置文件"),v("code",[s._v("sshd_config")]),s._v("的格式是，每个命令占据一行。每行都是配置项和对应的值，配置项的大小写不敏感，与值之间使用空格分隔。")]),s._v(" "),v("div",{staticClass:"language-bash extra-class"},[v("pre",{pre:!0,attrs:{class:"language-bash"}},[v("code",[s._v("Port "),v("span",{pre:!0,attrs:{class:"token number"}},[s._v("2034")]),s._v("\n")])])]),v("p",[s._v("上面的配置命令指定，配置项"),v("code",[s._v("Port")]),s._v("的值是"),v("code",[s._v("2034")]),s._v("。"),v("code",[s._v("Port")]),s._v("写成"),v("code",[s._v("port")]),s._v("也可。")]),s._v(" "),v("p",[s._v("配置文件还有另一种格式，就是配置项与值之间有一个等号，等号前后的空格可选。")]),s._v(" "),v("div",{staticClass:"language-bash extra-class"},[v("pre",{pre:!0,attrs:{class:"language-bash"}},[v("code",[s._v("Port "),v("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),v("span",{pre:!0,attrs:{class:"token number"}},[s._v("2034")]),s._v("\n")])])]),v("p",[s._v("配置文件里面，"),v("code",[s._v("#")]),s._v("开头的行表示注释。")]),s._v(" "),v("div",{staticClass:"language-bash extra-class"},[v("pre",{pre:!0,attrs:{class:"language-bash"}},[v("code",[v("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这是一行注释")]),s._v("\n")])])]),v("p",[s._v("注意，注释只能放在一行的开头，不能放在一行的结尾。")]),s._v(" "),v("div",{staticClass:"language-bash extra-class"},[v("pre",{pre:!0,attrs:{class:"language-bash"}},[v("code",[s._v("Port "),v("span",{pre:!0,attrs:{class:"token number"}},[s._v("2034")]),s._v(" "),v("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此处不允许注释")]),s._v("\n")])])]),v("p",[s._v("上面的写法是错误的。")]),s._v(" "),v("p",[s._v("另外，空行等同于注释。")]),s._v(" "),v("p",[s._v("sshd 启动时会自动读取默认的配置文件。如果希望使用其他的配置文件，可以用 sshd 命令的"),v("code",[s._v("-f")]),s._v("参数指定。")]),s._v(" "),v("div",{staticClass:"language-bash extra-class"},[v("pre",{pre:!0,attrs:{class:"language-bash"}},[v("code",[s._v("$ sshd -f /usr/local/ssh/my_config\n")])])]),v("p",[s._v("上面的命令指定 sshd 使用另一个配置文件"),v("code",[s._v("my_config")]),s._v("。")]),s._v(" "),v("p",[s._v("修改配置文件以后，可以用 sshd 命令的"),v("code",[s._v("-t")]),s._v("（test）检查有没有语法错误。")]),s._v(" "),v("div",{staticClass:"language-bash extra-class"},[v("pre",{pre:!0,attrs:{class:"language-bash"}},[v("code",[s._v("$ sshd -t\n")])])]),v("p",[s._v("配置文件修改以后，并不会自动生效，必须重新启动 sshd。")]),s._v(" "),v("div",{staticClass:"language-bash extra-class"},[v("pre",{pre:!0,attrs:{class:"language-bash"}},[v("code",[s._v("$ "),v("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart sshd.service\n")])])]),v("h2",{attrs:{id:"sshd-密钥"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#sshd-密钥"}},[s._v("#")]),s._v(" sshd 密钥")]),s._v(" "),v("p",[s._v("sshd 有自己的一对或多对密钥。它使用密钥向客户端证明自己的身份。所有密钥都是公钥和私钥成对出现，公钥的文件名一般是私钥文件名加上后缀"),v("code",[s._v(".pub")]),s._v("。")]),s._v(" "),v("p",[s._v("DSA 格式的密钥文件默认为"),v("code",[s._v("/etc/ssh/ssh_host_dsa_key")]),s._v("（公钥为"),v("code",[s._v("ssh_host_dsa_key.pub")]),s._v("），RSA 格式的密钥为"),v("code",[s._v("/etc/ssh/ssh_host_rsa_key")]),s._v("（公钥为"),v("code",[s._v("ssh_host_rsa_key.pub")]),s._v("）。如果需要支持 SSH 1 协议，则必须有密钥"),v("code",[s._v("/etc/ssh/ssh_host_key")]),s._v("。")]),s._v(" "),v("p",[s._v("如果密钥不是默认文件，那么可以通过配置文件"),v("code",[s._v("sshd_config")]),s._v("的"),v("code",[s._v("HostKey")]),s._v("配置项指定。默认密钥的"),v("code",[s._v("HostKey")]),s._v("设置如下。")]),s._v(" "),v("div",{staticClass:"language-bash extra-class"},[v("pre",{pre:!0,attrs:{class:"language-bash"}},[v("code",[v("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# HostKey for protocol version 1")]),s._v("\n"),v("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# HostKey /etc/ssh/ssh_host_key")]),s._v("\n\n"),v("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# HostKeys for protocol version 2")]),s._v("\n"),v("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# HostKey /etc/ssh/ssh_host_rsa_key")]),s._v("\n"),v("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# HostKey /etc/ssh/ssh_host_dsa_ke")]),s._v("\n")])])]),v("p",[s._v("上面命令前面的"),v("code",[s._v("#")]),s._v("表示这些行都是注释，因为这是默认值，有没有这几行都一样。")]),s._v(" "),v("p",[s._v("如果要修改密钥，就要去掉行首的"),v("code",[s._v("#")]),s._v("，指定其他密钥。")]),s._v(" "),v("div",{staticClass:"language-bash extra-class"},[v("pre",{pre:!0,attrs:{class:"language-bash"}},[v("code",[s._v("HostKey /usr/local/ssh/my_dsa_key\nHostKey /usr/local/ssh/my_rsa_key\nHostKey /usr/local/ssh/my_old_ssh1_key\n")])])]),v("h2",{attrs:{id:"sshd-配置项"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#sshd-配置项"}},[s._v("#")]),s._v(" sshd 配置项")]),s._v(" "),v("p",[s._v("以下是"),v("code",[s._v("/etc/ssh/sshd_config")]),s._v("文件里面的配置项。")]),s._v(" "),v("p",[v("strong",[s._v("AcceptEnv")])]),s._v(" "),v("p",[v("code",[s._v("AcceptEnv")]),s._v("指定允许接受客户端通过"),v("code",[s._v("SendEnv")]),s._v("命令发来的哪些环境变量，即允许客户端设置服务器的环境变量清单，变量名之间使用空格分隔（"),v("code",[s._v("AcceptEnv PATH TERM")]),s._v("）。")]),s._v(" "),v("p",[v("strong",[s._v("AllowGroups")])]),s._v(" "),v("p",[v("code",[s._v("AllowGroups")]),s._v("指定允许登录的用户组（"),v("code",[s._v("AllowGroups groupName")]),s._v("，多个组之间用空格分隔。如果不使用该项，则允许所有用户组登录。")]),s._v(" "),v("p",[v("strong",[s._v("AllowUsers")])]),s._v(" "),v("p",[v("code",[s._v("AllowUsers")]),s._v("指定允许登录的用户，用户名之间使用空格分隔（"),v("code",[s._v("AllowUsers user1 user2")]),s._v("），也可以使用多行"),v("code",[s._v("AllowUsers")]),s._v("命令指定，用户名支持使用通配符。如果不使用该项，则允许所有用户登录。该项也可以使用"),v("code",[s._v("用户名@域名")]),s._v("的格式（比如"),v("code",[s._v("AllowUsers jones@example.com")]),s._v("）。")]),s._v(" "),v("p",[v("strong",[s._v("AllowTcpForwarding")])]),s._v(" "),v("p",[v("code",[s._v("AllowTcpForwarding")]),s._v("指定是否允许端口转发，默认值为"),v("code",[s._v("yes")]),s._v("（"),v("code",[s._v("AllowTcpForwarding yes")]),s._v("），"),v("code",[s._v("local")]),s._v("表示只允许本地端口转发，"),v("code",[s._v("remote")]),s._v("表示只允许远程端口转发。")]),s._v(" "),v("p",[v("strong",[s._v("AuthorizedKeysFile")])]),s._v(" "),v("p",[v("code",[s._v("AuthorizedKeysFile")]),s._v("指定储存用户公钥的目录，默认是用户主目录的"),v("code",[s._v("ssh/authorized_keys")]),s._v("目录（"),v("code",[s._v("AuthorizedKeysFile .ssh/authorized_keys")]),s._v("）。")]),s._v(" "),v("p",[v("strong",[s._v("Banner")])]),s._v(" "),v("p",[v("code",[s._v("Banner")]),s._v("指定用户登录后，sshd 向其展示的信息文件（"),v("code",[s._v("Banner /usr/local/etc/warning.txt")]),s._v("），默认不展示任何内容。")]),s._v(" "),v("p",[v("strong",[s._v("ChallengeResponseAuthentication")])]),s._v(" "),v("p",[v("code",[s._v("ChallengeResponseAuthentication")]),s._v("指定是否使用“键盘交互”身份验证方案，默认值为"),v("code",[s._v("yes")]),s._v("（"),v("code",[s._v("ChallengeResponseAuthentication yes")]),s._v("）。")]),s._v(" "),v("p",[s._v("从理论上讲，“键盘交互”身份验证方案可以向用户询问多重问题，但是实践中，通常仅询问用户密码。如果要完全禁用基于密码的身份验证，请将"),v("code",[s._v("PasswordAuthentication")]),s._v("和"),v("code",[s._v("ChallengeResponseAuthentication")]),s._v("都设置为"),v("code",[s._v("no")]),s._v("。")]),s._v(" "),v("p",[v("strong",[s._v("Ciphers")])]),s._v(" "),v("p",[v("code",[s._v("Ciphers")]),s._v("指定 sshd 可以接受的加密算法（"),v("code",[s._v("Ciphers 3des-cbc")]),s._v("），多个算法之间使用逗号分隔。")]),s._v(" "),v("p",[v("strong",[s._v("ClientAliveCountMax")])]),s._v(" "),v("p",[v("code",[s._v("ClientAliveCountMax")]),s._v("指定建立连接后，客户端失去响应时，服务器尝试连接的次数（"),v("code",[s._v("ClientAliveCountMax 8")]),s._v("）。")]),s._v(" "),v("p",[v("strong",[s._v("ClientAliveInterval")])]),s._v(" "),v("p",[v("code",[s._v("ClientAliveInterval")]),s._v("指定允许客户端发呆的时间，单位为秒（"),v("code",[s._v("ClientAliveInterval 180")]),s._v("）。如果这段时间里面，客户端没有发送任何信号，SSH 连接将关闭。")]),s._v(" "),v("p",[v("strong",[s._v("Compression")])]),s._v(" "),v("p",[v("code",[s._v("Compression")]),s._v("指定客户端与服务器之间的数据传输是否压缩。默认值为"),v("code",[s._v("yes")]),s._v("（"),v("code",[s._v("Compression yes")]),s._v("）")]),s._v(" "),v("p",[v("strong",[s._v("DenyGroups")])]),s._v(" "),v("p",[v("code",[s._v("DenyGroups")]),s._v("指定不允许登录的用户组（"),v("code",[s._v("DenyGroups groupName")]),s._v("）。")]),s._v(" "),v("p",[v("strong",[s._v("DenyUsers")])]),s._v(" "),v("p",[v("code",[s._v("DenyUsers")]),s._v("指定不允许登录的用户（"),v("code",[s._v("DenyUsers user1")]),s._v("），用户名之间使用空格分隔，也可以使用多行"),v("code",[s._v("DenyUsers")]),s._v("命令指定。")]),s._v(" "),v("p",[v("strong",[s._v("FascistLogging")])]),s._v(" "),v("p",[s._v("SSH 1 版本专用，指定日志输出全部 Debug 信息（"),v("code",[s._v("FascistLogging yes")]),s._v("）。")]),s._v(" "),v("p",[v("strong",[s._v("HostKey")])]),s._v(" "),v("p",[v("code",[s._v("HostKey")]),s._v("指定 sshd 服务器的密钥，详见前文。")]),s._v(" "),v("p",[v("strong",[s._v("KeyRegenerationInterval")])]),s._v(" "),v("p",[v("code",[s._v("KeyRegenerationInterval")]),s._v("指定 SSH 1 版本的密钥重新生成时间间隔，单位为秒，默认是3600秒（"),v("code",[s._v("KeyRegenerationInterval 3600")]),s._v("）。")]),s._v(" "),v("p",[v("strong",[s._v("ListenAddress")])]),s._v(" "),v("p",[v("code",[s._v("ListenAddress")]),s._v("指定 sshd 监听的本机 IP 地址，即 sshd 启用的 IP 地址，默认是 0.0.0.0（"),v("code",[s._v("ListenAddress 0.0.0.0")]),s._v("）表示在本机所有网络接口启用。可以改成只在某个网络接口启用（比如"),v("code",[s._v("ListenAddress 192.168.10.23")]),s._v("），也可以指定某个域名启用（比如"),v("code",[s._v("ListenAddress server.example.com")]),s._v("）。")]),s._v(" "),v("p",[s._v("如果要监听多个指定的 IP 地址，可以使用多行"),v("code",[s._v("ListenAddress")]),s._v("命令。")]),s._v(" "),v("div",{staticClass:"language-bash extra-class"},[v("pre",{pre:!0,attrs:{class:"language-bash"}},[v("code",[s._v("ListenAddress "),v("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".1.1\nListenAddress "),v("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.1\n")])])]),v("p",[v("strong",[s._v("LoginGraceTime")])]),s._v(" "),v("p",[v("code",[s._v("LoginGraceTime")]),s._v("指定允许客户端登录时发呆的最长时间，比如用户迟迟不输入密码，连接就会自动断开，单位为秒（"),v("code",[s._v("LoginGraceTime 60")]),s._v("）。如果设为"),v("code",[s._v("0")]),s._v("，就表示没有限制。")]),s._v(" "),v("p",[v("strong",[s._v("LogLevel")])]),s._v(" "),v("p",[v("code",[s._v("LogLevel")]),s._v("指定日志的详细程度，可能的值依次为"),v("code",[s._v("QUIET")]),s._v("、"),v("code",[s._v("FATAL")]),s._v("、"),v("code",[s._v("ERROR")]),s._v("、"),v("code",[s._v("INFO")]),s._v("、"),v("code",[s._v("VERBOSE")]),s._v("、"),v("code",[s._v("DEBUG")]),s._v("、"),v("code",[s._v("DEBUG1")]),s._v("、"),v("code",[s._v("DEBUG2")]),s._v("、"),v("code",[s._v("DEBUG3")]),s._v("，默认为"),v("code",[s._v("INFO")]),s._v("（"),v("code",[s._v("LogLevel INFO")]),s._v("）。")]),s._v(" "),v("p",[v("strong",[s._v("MACs")])]),s._v(" "),v("p",[v("code",[s._v("MACs")]),s._v("指定sshd 可以接受的数据校验算法（"),v("code",[s._v("MACs hmac-sha1")]),s._v("），多个算法之间使用逗号分隔。")]),s._v(" "),v("p",[v("strong",[s._v("MaxAuthTries")])]),s._v(" "),v("p",[v("code",[s._v("MaxAuthTries")]),s._v("指定允许 SSH 登录的最大尝试次数（"),v("code",[s._v("MaxAuthTries 3")]),s._v("），如果密码输入错误达到指定次数，SSH 连接将关闭。")]),s._v(" "),v("p",[v("strong",[s._v("MaxStartups")])]),s._v(" "),v("p",[v("code",[s._v("MaxStartups")]),s._v("指定允许同时并发的 SSH 连接数量（MaxStartups）。如果设为"),v("code",[s._v("0")]),s._v("，就表示没有限制。")]),s._v(" "),v("p",[s._v("这个属性也可以设为"),v("code",[s._v("A:B:C")]),s._v("的形式，比如"),v("code",[s._v("MaxStartups 10:50:20")]),s._v("，表示如果达到10个并发连接，后面的连接将有50%的概率被拒绝；如果达到20个并发连接，则后面的连接将100%被拒绝。")]),s._v(" "),v("p",[v("strong",[s._v("PasswordAuthentication")])]),s._v(" "),v("p",[v("code",[s._v("PasswordAuthentication")]),s._v("指定是否允许密码登录，默认值为"),v("code",[s._v("yes")]),s._v("（"),v("code",[s._v("PasswordAuthentication yes")]),s._v("），建议改成"),v("code",[s._v("no")]),s._v("（禁止密码登录，只允许密钥登录）。")]),s._v(" "),v("p",[v("strong",[s._v("PermitEmptyPasswords")])]),s._v(" "),v("p",[v("code",[s._v("PermitEmptyPasswords")]),s._v("指定是否允许空密码登录，即用户的密码是否可以为空，默认为"),v("code",[s._v("yes")]),s._v("（"),v("code",[s._v("PermitEmptyPasswords yes")]),s._v("），建议改成"),v("code",[s._v("no")]),s._v("（禁止无密码登录）。")]),s._v(" "),v("p",[v("strong",[s._v("PermitRootLogin")])]),s._v(" "),v("p",[v("code",[s._v("PermitRootLogin")]),s._v("指定是否允许根用户登录，默认为"),v("code",[s._v("yes")]),s._v("（"),v("code",[s._v("PermitRootLogin yes")]),s._v("），建议改成"),v("code",[s._v("no")]),s._v("（禁止根用户登录）。")]),s._v(" "),v("p",[s._v("还有一种写法是写成"),v("code",[s._v("prohibit-password")]),s._v("，表示 root 用户不能用密码登录，但是可以用密钥登录。")]),s._v(" "),v("div",{staticClass:"language-bash extra-class"},[v("pre",{pre:!0,attrs:{class:"language-bash"}},[v("code",[s._v("PermitRootLogin prohibit-password\n")])])]),v("p",[v("strong",[s._v("PermitUserEnvironment")])]),s._v(" "),v("p",[v("code",[s._v("PermitUserEnvironment")]),s._v("指定是否允许 sshd 加载客户端的"),v("code",[s._v("~/.ssh/environment")]),s._v("文件和"),v("code",[s._v("~/.ssh/authorized_keys")]),s._v("文件里面的"),v("code",[s._v("environment= options")]),s._v("环境变量设置。默认值为"),v("code",[s._v("no")]),s._v("（"),v("code",[s._v("PermitUserEnvironment no")]),s._v("）。")]),s._v(" "),v("p",[v("strong",[s._v("Port")])]),s._v(" "),v("p",[v("code",[s._v("Port")]),s._v("指定 sshd 监听的端口，即客户端连接的端口，默认是22（"),v("code",[s._v("Port 22")]),s._v("）。出于安全考虑，可以改掉这个端口（比如"),v("code",[s._v("Port 8822")]),s._v("）。")]),s._v(" "),v("p",[s._v("配置文件可以使用多个"),v("code",[s._v("Port")]),s._v("命令，同时监听多个端口。")]),s._v(" "),v("div",{staticClass:"language-bash extra-class"},[v("pre",{pre:!0,attrs:{class:"language-bash"}},[v("code",[s._v("Port "),v("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v("\nPort "),v("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\nPort "),v("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("\nPort "),v("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n")])])]),v("p",[s._v("上面的示例表示同时监听4个端口。")]),s._v(" "),v("p",[v("strong",[s._v("PrintMotd")])]),s._v(" "),v("p",[v("code",[s._v("PrintMotd")]),s._v("指定用户登录后，是否向其展示系统的 motd（Message of the day）的信息文件"),v("code",[s._v("/etc/motd")]),s._v("。该文件用于通知所有用户一些重要事项，比如系统维护时间、安全问题等等。默认值为"),v("code",[s._v("yes")]),s._v("（"),v("code",[s._v("PrintMotd yes")]),s._v("），由于 Shell 一般会展示这个信息文件，所以这里可以改为"),v("code",[s._v("no")]),s._v("。")]),s._v(" "),v("p",[v("strong",[s._v("PrintLastLog")])]),s._v(" "),v("p",[v("code",[s._v("PrintLastLog")]),s._v("指定是否打印上一次用户登录时间，默认值为"),v("code",[s._v("yes")]),s._v("（"),v("code",[s._v("PrintLastLog yes")]),s._v("）。")]),s._v(" "),v("p",[v("strong",[s._v("Protocol")])]),s._v(" "),v("p",[v("code",[s._v("Protocol")]),s._v("指定 sshd 使用的协议。"),v("code",[s._v("Protocol 1")]),s._v("表示使用 SSH 1 协议，建议改成"),v("code",[s._v("Protocol 2")]),s._v("（使用 SSH 2 协议）。"),v("code",[s._v("Protocol 2,1")]),s._v("表示同时支持两个版本的协议。")]),s._v(" "),v("p",[v("strong",[s._v("PubKeyAuthentication")])]),s._v(" "),v("p",[v("code",[s._v("PubKeyAuthentication")]),s._v("指定是否允许公钥登录，默认值为"),v("code",[s._v("yes")]),s._v("（"),v("code",[s._v("PubKeyAuthentication yes")]),s._v("）。")]),s._v(" "),v("p",[v("strong",[s._v("QuietMode")])]),s._v(" "),v("p",[s._v("SSH 1 版本专用，指定日志只输出致命的错误信息（"),v("code",[s._v("QuietMode yes")]),s._v("）。")]),s._v(" "),v("p",[v("strong",[s._v("RSAAuthentication")])]),s._v(" "),v("p",[v("code",[s._v("RSAAuthentication")]),s._v("指定允许 RSA 认证，默认值为"),v("code",[s._v("yes")]),s._v("（"),v("code",[s._v("RSAAuthentication yes")]),s._v("）。")]),s._v(" "),v("p",[v("strong",[s._v("ServerKeyBits")])]),s._v(" "),v("p",[v("code",[s._v("ServerKeyBits")]),s._v("指定 SSH 1 版本的密钥重新生成时的位数，默认是768（"),v("code",[s._v("ServerKeyBits 768")]),s._v("）。")]),s._v(" "),v("p",[v("strong",[s._v("StrictModes")])]),s._v(" "),v("p",[v("code",[s._v("StrictModes")]),s._v("指定 sshd 是否检查用户的一些重要文件和目录的权限。默认为"),v("code",[s._v("yes")]),s._v("（"),v("code",[s._v("StrictModes yes")]),s._v("），即对于用户的 SSH 配置文件、密钥文件和所在目录，SSH 要求拥有者必须是根用户或用户本人，用户组和其他人的写权限必须关闭。")]),s._v(" "),v("p",[v("strong",[s._v("SyslogFacility")])]),s._v(" "),v("p",[v("code",[s._v("SyslogFacility")]),s._v("指定 Syslog 如何处理 sshd 的日志，默认是 Auth（"),v("code",[s._v("SyslogFacility AUTH")]),s._v("）。")]),s._v(" "),v("p",[v("strong",[s._v("TCPKeepAlive")])]),s._v(" "),v("p",[v("code",[s._v("TCPKeepAlive")]),s._v("指定打开 sshd 跟客户端 TCP 连接的 keepalive 参数（"),v("code",[s._v("TCPKeepAlive yes")]),s._v("）。")]),s._v(" "),v("p",[v("strong",[s._v("UseDNS")])]),s._v(" "),v("p",[v("code",[s._v("UseDNS")]),s._v("指定用户 SSH 登录一个域名时，服务器是否使用 DNS，确认该域名对应的 IP 地址包含本机（"),v("code",[s._v("UseDNS yes")]),s._v("）。打开该选项意义不大，而且如果 DNS 更新不及时，还有可能误判，建议关闭。")]),s._v(" "),v("p",[v("strong",[s._v("UseLogin")])]),s._v(" "),v("p",[v("code",[s._v("UseLogin")]),s._v("指定用户认证内部是否使用"),v("code",[s._v("/usr/bin/login")]),s._v("替代 SSH 工具，默认为"),v("code",[s._v("no")]),s._v("（"),v("code",[s._v("UseLogin no")]),s._v("）。")]),s._v(" "),v("p",[v("strong",[s._v("UserPrivilegeSeparation")])]),s._v(" "),v("p",[v("code",[s._v("UserPrivilegeSeparation")]),s._v("指定用户认证通过以后，使用另一个子线程处理用户权限相关的操作，这样有利于提高安全性。默认值为"),v("code",[s._v("yes")]),s._v("（"),v("code",[s._v("UsePrivilegeSeparation yes")]),s._v("）。")]),s._v(" "),v("p",[v("strong",[s._v("VerboseMode")])]),s._v(" "),v("p",[s._v("SSH 2 版本专用，指定日志输出详细的 Debug 信息（"),v("code",[s._v("VerboseMode yes")]),s._v("）。")]),s._v(" "),v("p",[v("strong",[s._v("X11Forwarding")])]),s._v(" "),v("p",[v("code",[s._v("X11Forwarding")]),s._v("指定是否打开 X window 的转发，默认值为 no（"),v("code",[s._v("X11Forwarding no")]),s._v("）。")]),s._v(" "),v("p",[s._v("修改配置文件以后，可以使用下面的命令验证，配置文件是否有语法错误。")]),s._v(" "),v("div",{staticClass:"language-bash extra-class"},[v("pre",{pre:!0,attrs:{class:"language-bash"}},[v("code",[s._v("$ sshd -t\n")])])]),v("p",[s._v("新的配置文件生效，必须重启 sshd。")]),s._v(" "),v("div",{staticClass:"language-bash extra-class"},[v("pre",{pre:!0,attrs:{class:"language-bash"}},[v("code",[s._v("$ "),v("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart sshd\n")])])]),v("h2",{attrs:{id:"sshd-的命令行配置项"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#sshd-的命令行配置项"}},[s._v("#")]),s._v(" sshd 的命令行配置项")]),s._v(" "),v("p",[s._v("sshd 命令有一些配置项。这些配置项在调用时指定，可以覆盖配置文件的设置。")]),s._v(" "),v("p",[s._v("（1）"),v("code",[s._v("-d")])]),s._v(" "),v("p",[v("code",[s._v("-d")]),s._v("参数用于显示 debug 信息。")]),s._v(" "),v("div",{staticClass:"language-bash extra-class"},[v("pre",{pre:!0,attrs:{class:"language-bash"}},[v("code",[s._v("$ sshd -d\n")])])]),v("p",[s._v("（2）"),v("code",[s._v("-D")])]),s._v(" "),v("p",[v("code",[s._v("-D")]),s._v("参数指定 sshd 不作为后台守护进程运行。")]),s._v(" "),v("div",{staticClass:"language-bash extra-class"},[v("pre",{pre:!0,attrs:{class:"language-bash"}},[v("code",[s._v("$ sshd -D\n")])])]),v("p",[s._v("（3）"),v("code",[s._v("-e")])]),s._v(" "),v("p",[v("code",[s._v("-e")]),s._v("参数将 sshd 写入系统日志 syslog 的内容导向标准错误（standard error）。")]),s._v(" "),v("p",[s._v("（4）"),v("code",[s._v("-f")])]),s._v(" "),v("p",[v("code",[s._v("-f")]),s._v("参数指定配置文件的位置。")]),s._v(" "),v("p",[s._v("（5）"),v("code",[s._v("-h")])]),s._v(" "),v("p",[v("code",[s._v("-h")]),s._v("参数用于指定密钥。")]),s._v(" "),v("div",{staticClass:"language-bash extra-class"},[v("pre",{pre:!0,attrs:{class:"language-bash"}},[v("code",[s._v("$ sshd -h /usr/local/ssh/my_rsa_key\n")])])]),v("p",[s._v("（6）"),v("code",[s._v("-o")])]),s._v(" "),v("p",[v("code",[s._v("-o")]),s._v("参数指定配置文件的一个配置项和对应的值。")]),s._v(" "),v("div",{staticClass:"language-bash extra-class"},[v("pre",{pre:!0,attrs:{class:"language-bash"}},[v("code",[s._v("$ sshd -o "),v("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Port 2034"')]),s._v("\n")])])]),v("p",[s._v("配置项和对应值之间，可以使用等号。")]),s._v(" "),v("div",{staticClass:"language-bash extra-class"},[v("pre",{pre:!0,attrs:{class:"language-bash"}},[v("code",[s._v("$ sshd -o "),v("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Port = 2034"')]),s._v("\n")])])]),v("p",[s._v("如果省略等号前后的空格，也可以不使用引号。")]),s._v(" "),v("div",{staticClass:"language-bash extra-class"},[v("pre",{pre:!0,attrs:{class:"language-bash"}},[v("code",[s._v("$ sshd -o "),v("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Port")]),v("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),v("span",{pre:!0,attrs:{class:"token number"}},[s._v("2034")]),s._v("\n")])])]),v("p",[v("code",[s._v("-o")]),s._v("参数可以多个一起使用，用来指定多个配置关键字。")]),s._v(" "),v("p",[s._v("（7）"),v("code",[s._v("-p")])]),s._v(" "),v("p",[v("code",[s._v("-p")]),s._v("参数指定 sshd 的服务端口。")]),s._v(" "),v("div",{staticClass:"language-bash extra-class"},[v("pre",{pre:!0,attrs:{class:"language-bash"}},[v("code",[s._v("$ sshd -p "),v("span",{pre:!0,attrs:{class:"token number"}},[s._v("2034")]),s._v("\n")])])]),v("p",[s._v("上面命令指定 sshd 在"),v("code",[s._v("2034")]),s._v("端口启动。")]),s._v(" "),v("p",[v("code",[s._v("-p")]),s._v("参数可以指定多个端口。")]),s._v(" "),v("div",{staticClass:"language-bash extra-class"},[v("pre",{pre:!0,attrs:{class:"language-bash"}},[v("code",[s._v("$ sshd -p "),v("span",{pre:!0,attrs:{class:"token number"}},[s._v("2222")]),s._v(" -p "),v("span",{pre:!0,attrs:{class:"token number"}},[s._v("3333")]),s._v("\n")])])]),v("p",[s._v("（8）"),v("code",[s._v("-t")])]),s._v(" "),v("p",[v("code",[s._v("-t")]),s._v("参数检查配置文件的语法是否正确。")])])}),[],!1,null,null,null);e.default=t.exports}}]);